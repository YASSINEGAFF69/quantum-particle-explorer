<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Particle Explorer</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        :root {
            --quantum-blue: #0ff;
            --quantum-purple: #90f;
            --quantum-teal: #2dd;
            --dark-bg: #00101f;
            --panel-bg: rgba(5, 25, 45, 0.95);
            --border-color: rgba(0, 200, 255, 0.2);
            --card-bg: rgba(10, 35, 60, 0.7);
            --accent: #3b82f6;
            --text-primary: #e2e8f0;
            --text-secondary: #94a3b8;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background: var(--dark-bg);
            color: var(--text-primary);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            padding: 12px;
            gap: 12px;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(0, 100, 255, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(150, 0, 255, 0.1) 0%, transparent 20%);
        }
        
        /* Header */
        .header {
            background: var(--panel-bg);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(5px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            flex-shrink: 0;
        }
        
        .header-content h1 {
            font-size: 1.5rem;
            background: linear-gradient(90deg, var(--quantum-blue), var(--quantum-purple));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            margin-bottom: 4px;
        }
        
        .header-content p {
            color: var(--text-secondary);
            font-size: 0.85rem;
            max-width: 500px;
        }
        
        .stats {
            display: flex;
            gap: 15px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--quantum-teal);
            font-family: 'JetBrains Mono', monospace;
        }
        
        .stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* Main Content */
        .main-content {
            display: flex;
            flex: 1;
            min-height: 0;
            gap: 12px;
        }
        
        /* Control Panel */
        .control-panel {
            background: var(--panel-bg);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            backdrop-filter: blur(5px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            width: 280px;
            flex-shrink: 0;
            overflow: hidden;
        }
        
        .panel-tabs {
            display: flex;
            background: rgba(10, 30, 50, 0.8);
            border-bottom: 1px solid var(--border-color);
        }
        
        .tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.3s ease;
            color: var(--text-secondary);
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            color: var(--quantum-blue);
            border-bottom: 3px solid var(--quantum-blue);
            background: rgba(15, 40, 70, 0.4);
        }
        
        .tab-content {
            padding: 15px;
            overflow-y: auto;
            flex: 1;
        }
        
        .tab-pane {
            display: none;
        }
        
        .tab-pane.active {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .card {
            background: var(--card-bg);
            border-radius: 10px;
            border: 1px solid var(--border-color);
            padding: 12px;
            margin-bottom: 12px;
        }
        
        .card-title {
            font-size: 0.95rem;
            color: var(--quantum-teal);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .card-title i {
            font-size: 1.1rem;
        }
        
        .control-group {
            margin-bottom: 12px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-size: 0.85rem;
            color: var(--text-primary);
        }
        
        input[type="range"] {
            width: 100%;
            height: 5px;
            background: rgba(0, 100, 200, 0.2);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: var(--quantum-blue);
            cursor: pointer;
            box-shadow: 0 0 6px rgba(0, 200, 255, 0.8);
        }
        
        .value-display {
            display: inline-block;
            min-width: 35px;
            text-align: right;
            color: var(--quantum-teal);
            font-weight: 500;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
        }
        
        .button-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }
        
        button {
            background: rgba(0, 60, 120, 0.4);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        button:hover {
            background: rgba(0, 100, 200, 0.6);
            transform: translateY(-2px);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        button.active {
            background: rgba(0, 150, 255, 0.7);
            box-shadow: 0 0 8px rgba(0, 200, 255, 0.4);
            border-color: var(--quantum-blue);
        }
        
        .algorithm-btn {
            background: linear-gradient(45deg, #ff6b6b, #ffa502) !important;
            color: #fff !important;
            border: none !important;
            font-weight: 600 !important;
        }
        
        .special-button {
            background: linear-gradient(45deg, #0fb9b1, #2d98da) !important;
            color: #fff !important;
            border: none !important;
            font-weight: 600 !important;
            padding: 10px !important;
            font-size: 0.9rem;
            margin-top: 8px;
        }
        
        /* Visualization Area */
        .visualization {
            background: black;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            backdrop-filter: blur(5px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            position: relative;
            flex: 1;
            min-width: 0;
            min-height: 0;
        }
        
        #quantumCanvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        .algorithm-viz {
            position: absolute;
            bottom: 15px;
            left: 15px;
            background: rgba(0, 30, 60, 0.7);
            border-radius: 8px;
            padding: 12px;
            width: 280px;
            height: 130px;
        }
        
        .quantum-circuit {
            position: absolute;
            height: 100%;
            width: 100%;
            top: 0;
            left: 0;
        }
        
        .circuit-line {
            position: absolute;
            height: 2px;
            background: rgba(0, 200, 255, 0.5);
            transform-origin: left center;
        }
        
        .gate {
            position: absolute;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            border: 2px solid var(--quantum-purple);
            border-radius: 5px;
            background: rgba(100, 0, 200, 0.3);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
        }
        
        /* FPS Warning */
        .fps-warning {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(200, 50, 50, 0.9);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            z-index: 1000;
            display: none;
        }
        
        /* Grover Target */
        .grover-target {
            position: absolute;
            border-radius: 50%;
            pointer-events: none;
            z-index: 10;
        }
        
        /* Footer */
        .footer {
            background: var(--panel-bg);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(5px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            flex-shrink: 0;
        }
        
        .footer-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .footer-item span {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }
        
        .footer-item .value {
            color: var(--quantum-teal);
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.95rem;
        }
        
        /* Info Panel */
        .info-panel {
            background: rgba(0, 40, 80, 0.5);
            border-radius: 8px;
            padding: 12px;
            margin-top: 10px;
            border-left: 3px solid var(--quantum-teal);
            flex-shrink: 0;
        }
        
        .info-panel h3 {
            color: var(--quantum-blue);
            margin-bottom: 6px;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .info-panel p {
            color: #ccf;
            font-size: 0.85rem;
            line-height: 1.5;
        }
        
        .quantum-state {
            display: inline-block;
            padding: 2px 6px;
            background: rgba(0, 100, 200, 0.3);
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
            color: var(--quantum-teal);
            margin: 4px 0;
            font-size: 0.85rem;
        }
        
        /* Real-world applications */
        .applications-panel {
            background: rgba(0, 50, 100, 0.6);
            border-radius: 10px;
            padding: 15px;
            margin-top: 12px;
            border-top: 2px solid var(--quantum-purple);
        }
        
        .applications-panel h3 {
            color: var(--quantum-teal);
            margin-bottom: 10px;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .applications-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .application-tag {
            background: rgba(0, 150, 255, 0.3);
            border: 1px solid rgba(100, 200, 255, 0.3);
            border-radius: 20px;
            padding: 4px 12px;
            font-size: 0.8rem;
        }
        
        /* Responsive Adjustments */
        @media (max-width: 1200px) {
            .control-panel {
                width: 250px;
            }
        }
        
        @media (max-width: 900px) {
            .main-content {
                flex-direction: column;
            }
            
            .control-panel {
                width: 100%;
                max-height: 300px;
            }
            
            .header {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }
            
            .header-content {
                width: 100%;
            }
            
            .stats {
                justify-content: center;
            }
            
            .algorithm-viz {
                width: 250px;
                height: 120px;
            }
        }
        
        @media (max-width: 600px) {
            .header-content h1 {
                font-size: 1.3rem;
            }
            
            .header-content p {
                font-size: 0.8rem;
            }
            
            .stat-value {
                font-size: 1rem;
            }
            
            .footer {
                flex-direction: column;
                gap: 8px;
                align-items: flex-start;
            }
            
            .algorithm-viz {
                width: 200px;
                height: 100px;
                bottom: 10px;
                left: 10px;
            }
        }
        
        @media (max-width: 480px) {
            .panel-tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                min-width: 33.33%;
                font-size: 0.8rem;
                padding: 8px;
            }
            
            .button-grid {
                grid-template-columns: 1fr;
            }
            
            .algorithm-viz {
                position: relative;
                width: 100%;
                height: 100px;
                bottom: 0;
                left: 0;
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- FPS Warning -->
    <div class="fps-warning" id="fpsWarning">
        Low FPS detected! Optimizing system...
    </div>
    
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <h1>Quantum Particle Explorer</h1>
            <p>Visualize quantum computing principles through interactive particle dynamics</p>
        </div>
        <div class="stats">
            <div class="stat-item">
                <div class="stat-value" id="fpsCounter">60</div>
                <div class="stat-label">FPS</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="particleCounter">150</div>
                <div class="stat-label">Qubits</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="entanglementCounter">0</div>
                <div class="stat-label">Entangled</div>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <!-- Control Panel -->
        <div class="control-panel">
            <div class="panel-tabs">
                <div class="tab active" data-tab="parameters">Parameters</div>
                <div class="tab" data-tab="effects">Effects</div>
                <div class="tab" data-tab="algorithms">Algorithms</div>
            </div>
            
            <div class="tab-content">
                <!-- Parameters Tab -->
                <div class="tab-pane active" id="parameters-tab">
                    <div class="card">
                        <div class="card-title">
                            <i class="material-icons">tune</i>
                            System Parameters
                        </div>
                        
                        <div class="control-group">
                            <label for="particleCount">Qubit Count: <span class="value-display" id="particleCountValue">150</span></label>
                            <input type="range" id="particleCount" min="50" max="500" value="150">
                        </div>
                        
                        <div class="control-group">
                            <label for="connectionRadius">Entanglement Radius: <span class="value-display" id="connectionRadiusValue">150</span></label>
                            <input type="range" id="connectionRadius" min="50" max="300" value="150">
                        </div>
                        
                        <div class="control-group">
                            <label for="particleSpeed">Quantum Speed: <span class="value-display" id="particleSpeedValue">1.0</span></label>
                            <input type="range" id="particleSpeed" min="0.1" max="3.0" step="0.1" value="1.0">
                        </div>
                        
                        <div class="control-group">
                            <label for="glowIntensity">Superposition Glow: <span class="value-display" id="glowIntensityValue">20</span></label>
                            <input type="range" id="glowIntensity" min="5" max="40" value="20">
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-title">
                            <i class="material-icons">palette</i>
                            Visual Styles
                        </div>
                        <div class="button-grid">
                            <button id="cosmicPreset">
                                <i class="material-icons">dark_mode</i> Cosmic
                            </button>
                            <button id="matrixPreset">
                                <i class="material-icons">code</i> Matrix
                            </button>
                            <button id="firefliesPreset">
                                <i class="material-icons">flare</i> Fireflies
                            </button>
                            <button id="rainbowPreset">
                                <i class="material-icons">gradient</i> Rainbow
                            </button>
                        </div>
                    </div>
                    
                    <button class="special-button" id="randomizeBtn">
                        <i class="material-icons">shuffle</i> Quantum Randomize
                    </button>
                </div>
                
                <!-- Effects Tab -->
                <div class="tab-pane" id="effects-tab">
                    <div class="card">
                        <div class="card-title">
                            <i class="material-icons">waves</i>
                            Physics Effects
                        </div>
                        <div class="button-grid">
                            <button id="gravityBtn">
                                <i class="material-icons">compress</i> Gravity
                            </button>
                            <button id="timeBtn">
                                <i class="material-icons">schedule</i> Time Dilation
                            </button>
                            <button id="vortexBtn">
                                <i class="material-icons">rotate_right</i> Vortex
                            </button>
                            <button id="blackholeBtn">
                                <i class="material-icons">filter_center_focus</i> Black Hole
                            </button>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-title">
                            <i class="material-icons">color_lens</i>
                            Visual Effects
                        </div>
                        <div class="button-grid">
                            <button id="colorBtn">
                                <i class="material-icons">colorize</i> Color Wave
                            </button>
                            <button id="repulsionBtn">
                                <i class="material-icons">close</i> Repulsion
                            </button>
                            <button id="pulseBtn">
                                <i class="material-icons">waves</i> Pulse Wave
                            </button>
                            <button id="tornadoBtn">
                                <i class="material-icons">cyclone</i> Tornado
                            </button>
                            <button id="trailsBtn">
                                <i class="material-icons">timeline</i> Trails
                            </button>
                            <button id="explosionBtn">
                                <i class="material-icons">explosion</i> Collapse
                            </button>
                        </div>
                    </div>
                    
                    <button class="special-button" id="entanglementBtn">
                        <i class="material-icons">link</i> Create Entanglement
                    </button>
                </div>
                
                <!-- Algorithms Tab -->
                <div class="tab-pane" id="algorithms-tab">
                    <div class="card">
                        <div class="card-title">
                            <i class="material-icons">calculate</i>
                            Quantum Algorithms
                        </div>
                        <div class="button-grid">
                            <button id="groverBtn" class="algorithm-btn">
                                <i class="material-icons">search</i> Grover's Search
                            </button>
                            <button id="shorBtn" class="algorithm-btn">
                                <i class="material-icons">functions</i> Shor's Algorithm
                            </button>
                        </div>
                    </div>
                    
                    <div class="info-panel">
                        <h3><i class="material-icons">science</i> Quantum Superposition</h3>
                        <p>Particles exist in multiple states simultaneously: <span class="quantum-state">α|0⟩ + β|1⟩</span></p>
                    </div>
                    
                    <div class="info-panel">
                        <h3><i class="material-icons">hub</i> Quantum Entanglement</h3>
                        <p>Connected particles share a quantum state, affecting each other instantly regardless of distance.</p>
                    </div>
                    
                    <div class="applications-panel">
                        <h3><i class="material-icons">public</i> Real-World Applications</h3>
                        <div class="applications-list">
                            <span class="application-tag">Drug Discovery</span>
                            <span class="application-tag">Cryptography</span>
                            <span class="application-tag">Optimization</span>
                            <span class="application-tag">AI Training</span>
                            <span class="application-tag">Financial Modeling</span>
                            <span class="application-tag">Material Science</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Visualization Area -->
        <div class="visualization">
            <canvas id="quantumCanvas"></canvas>
            <div class="algorithm-viz">
                <div class="quantum-circuit" id="circuitContainer"></div>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <div class="footer">
        <div class="footer-item">
            <span>Quantum State:</span>
            <div class="value" id="quantumState">|ψ⟩</div>
        </div>
        <div class="footer-item">
            <span>Current Effect:</span>
            <div class="value" id="currentEffect">None</div>
        </div>
        <div class="footer-item">
            <button id="resetBtn">
                <i class="material-icons">refresh</i> Reset System
            </button>
        </div>
    </div>

    <script>
        class QuantumParticle {
            constructor(x, y, color, speed) {
                this.x = x;
                this.y = y;
                this.baseRadius = Math.random() * 3 + 1;
                this.radius = this.baseRadius;
                this.dx = (Math.random() - 0.5) * 2 * speed;
                this.dy = (Math.random() - 0.5) * 2 * speed;
                this.color = color;
                this.originalSpeed = speed;
                this.trail = [];
                this.entangledWith = null;
                this.quantumState = Math.random() > 0.5 ? 0 : 1;
                this.phase = Math.random() * Math.PI * 2;
            }
            
            update(width, height, delta = 16) {
                const normalizedDelta = delta / 16;
                
                // Quantum state evolution
                this.quantumState = (this.quantumState + normalizedDelta * 0.1) % 2;
                this.phase += normalizedDelta * 0.05;
                
                // Apply quantum wave behavior
                const waveInfluence = 0.3;
                this.dx += Math.sin(this.phase) * waveInfluence * normalizedDelta;
                this.dy += Math.cos(this.phase) * waveInfluence * normalizedDelta;
                
                this.x += this.dx * normalizedDelta;
                this.y += this.dy * normalizedDelta;
                
                // Bounce off edges with quantum tunneling probability
                const tunnelProbability = 0.01;
                if (this.x < 0) {
                    if (Math.random() < tunnelProbability) {
                        this.x = width;
                    } else {
                        this.dx = Math.abs(this.dx);
                        this.x = 0;
                    }
                }
                if (this.x > width) {
                    if (Math.random() < tunnelProbability) {
                        this.x = 0;
                    } else {
                        this.dx = -Math.abs(this.dx);
                        this.x = width;
                    }
                }
                if (this.y < 0) {
                    if (Math.random() < tunnelProbability) {
                        this.y = height;
                    } else {
                        this.dy = Math.abs(this.dy);
                        this.y = 0;
                    }
                }
                if (this.y > height) {
                    if (Math.random() < tunnelProbability) {
                        this.y = 0;
                    } else {
                        this.dy = -Math.abs(this.dy);
                        this.y = height;
                    }
                }
                
                // Normalize speed
                const speed = Math.hypot(this.dx, this.dy);
                if (speed > this.originalSpeed * 2) {
                    this.dx = (this.dx / speed) * this.originalSpeed * 2;
                    this.dy = (this.dy / speed) * this.originalSpeed * 2;
                }
            }
            
            draw(ctx, glowIntensity) {
                ctx.beginPath();
                ctx.fillStyle = this.color;
                
                // Glow effect based on quantum state
                const intensity = glowIntensity * (0.5 + Math.abs(Math.sin(this.quantumState * Math.PI)));
                ctx.shadowBlur = intensity;
                ctx.shadowColor = this.color;
                
                // Draw quantum waveform around particle
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fill();
                
                // Draw entanglement connection if exists
                if (this.entangledWith) {
                    ctx.beginPath();
                    ctx.strokeStyle = `hsla(${(Date.now() * 0.1) % 360}, 100%, 70%, 0.5)`;
                    ctx.lineWidth = 1;
                    ctx.moveTo(this.x, this.y);
                    ctx.lineTo(this.entangledWith.x, this.entangledWith.y);
                    ctx.stroke();
                    
                    // Entangled particles mirror each other's quantum state
                    this.quantumState = this.entangledWith.quantumState;
                }
                
                // Reset shadow
                ctx.shadowBlur = 0;
            }
        }

        class QuantumParticleAnimation {
            constructor() {
                this.canvas = document.getElementById('quantumCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.particles = [];
                this.connectionRadius = 150;
                this.particleCount = 150;
                this.particleSpeed = 1;
                this.glowIntensity = 20;
                this.gravityWellActive = false;
                this.timeDilationActive = false;
                this.vortexActive = false;
                this.colorWaveActive = false;
                this.repulsionActive = false;
                this.explosionTime = 0;
                this.pulseWaveActive = false;
                this.tornadoActive = false;
                this.blackHoleActive = false;
                this.trailsActive = false;
                this.pulseTime = 0;
                this.tornadoAngle = 0;
                this.mousePos = { x: 0, y: 0 };
                this.lastTime = performance.now();
                this.fps = 0;
                this.frameCount = 0;
                this.lastFpsUpdate = 0;
                this.colorWaveOffset = 0;
                this.entanglementCount = 0;
                this.quantumAlgorithmActive = false;
                this.quantumState = "|ψ⟩";
                this.activeEffect = "None";
                this.startTime = performance.now();
                this.lowFpsWarning = false;
                this.searchTarget = null;
                this.algorithmTime = 0;
                this.vortexCenter = { x: 0, y: 0 };
                this.blackHoleCenter = { x: 0, y: 0 };
                
                this.colorSchemes = {
                    default: () => `hsla(${Math.random() * 360}, 70%, 60%, 0.8)`,
                    cosmic: () => `hsla(${Math.random() * 60 + 220}, 80%, 60%, 0.8)`,
                    matrix: () => `hsla(120, ${Math.random() * 40 + 60}%, 50%, 0.8)`,
                    fireflies: () => `hsla(${Math.random() * 40 + 20}, 100%, 70%, 0.8)`,
                    rainbow: () => `hsla(${(Date.now() * 0.1) % 360}, 80%, 60%, 0.8)`
                };
                this.currentColorScheme = 'default';
                
                this.resize();
                this.initParticles();
                this.setupEventListeners();
                this.animate();
                this.updateQuantumState();
                this.setupTabs();
            }
            
            setupTabs() {
                const tabs = document.querySelectorAll('.tab');
                tabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        tabs.forEach(t => t.classList.remove('active'));
                        tab.classList.add('active');
                        
                        document.querySelectorAll('.tab-pane').forEach(pane => {
                            pane.classList.remove('active');
                        });
                        
                        const tabId = tab.getAttribute('data-tab');
                        document.getElementById(`${tabId}-tab`).classList.add('active');
                    });
                });
            }
            
            setupEventListeners() {
                window.addEventListener('resize', () => this.resize());
                this.canvas.addEventListener('mousemove', (e) => {
                    const rect = this.canvas.getBoundingClientRect();
                    this.mousePos.x = e.clientX - rect.left;
                    this.mousePos.y = e.clientY - rect.top;
                    
                    if (this.vortexActive) {
                        this.vortexCenter = { x: this.mousePos.x, y: this.mousePos.y };
                    }
                    if (this.blackHoleActive) {
                        this.blackHoleCenter = { x: this.mousePos.x, y: this.mousePos.y };
                    }
                });

                document.getElementById('particleCount').addEventListener('input', (e) => {
                    this.particleCount = parseInt(e.target.value);
                    document.getElementById('particleCountValue').textContent = this.particleCount;
                    this.initParticles();
                });
                
                document.getElementById('connectionRadius').addEventListener('input', (e) => {
                    this.connectionRadius = parseInt(e.target.value);
                    document.getElementById('connectionRadiusValue').textContent = this.connectionRadius;
                });
                
                document.getElementById('particleSpeed').addEventListener('input', (e) => {
                    this.particleSpeed = parseFloat(e.target.value);
                    document.getElementById('particleSpeedValue').textContent = this.particleSpeed.toFixed(1);
                    this.updateParticleSpeed();
                });
                
                document.getElementById('glowIntensity').addEventListener('input', (e) => {
                    this.glowIntensity = parseInt(e.target.value);
                    document.getElementById('glowIntensityValue').textContent = this.glowIntensity;
                });
                
                // Preset buttons
                document.getElementById('cosmicPreset').addEventListener('click', () => this.setPreset('cosmic'));
                document.getElementById('matrixPreset').addEventListener('click', () => this.setPreset('matrix'));
                document.getElementById('firefliesPreset').addEventListener('click', () => this.setPreset('fireflies'));
                document.getElementById('rainbowPreset').addEventListener('click', () => this.setPreset('rainbow'));
                
                // Effect buttons
                document.getElementById('gravityBtn').addEventListener('click', () => this.toggleGravityWell());
                document.getElementById('timeBtn').addEventListener('click', () => this.toggleTimeDilation());
                document.getElementById('vortexBtn').addEventListener('click', () => this.toggleVortex());
                document.getElementById('blackholeBtn').addEventListener('click', () => this.toggleBlackHole());
                document.getElementById('colorBtn').addEventListener('click', () => this.toggleColorWave());
                document.getElementById('repulsionBtn').addEventListener('click', () => this.toggleRepulsion());
                document.getElementById('pulseBtn').addEventListener('click', () => this.togglePulseWave());
                document.getElementById('tornadoBtn').addEventListener('click', () => this.toggleTornado());
                document.getElementById('trailsBtn').addEventListener('click', () => this.toggleTrails());
                document.getElementById('explosionBtn').addEventListener('click', () => this.triggerExplosion());
                
                // Algorithm buttons
                document.getElementById('groverBtn').addEventListener('click', () => this.runGroverAlgorithm());
                document.getElementById('shorBtn').addEventListener('click', () => this.runShorAlgorithm());
                
                // Special buttons
                document.getElementById('randomizeBtn').addEventListener('click', () => this.randomize());
                document.getElementById('entanglementBtn').addEventListener('click', () => this.quantumEntanglement());
                document.getElementById('resetBtn').addEventListener('click', () => location.reload());
            }
            
            updateParticleSpeed() {
                for (let particle of this.particles) {
                    const currentSpeed = Math.hypot(particle.dx, particle.dy);
                    particle.dx = (particle.dx / currentSpeed) * this.particleSpeed;
                    particle.dy = (particle.dy / currentSpeed) * this.particleSpeed;
                    particle.originalSpeed = this.particleSpeed;
                }
            }
            
            setPreset(preset) {
                this.currentColorScheme = preset;
                switch(preset) {
                    case 'cosmic':
                        this.particleSpeed = 0.5;
                        this.glowIntensity = 30;
                        break;
                    case 'matrix':
                        this.particleSpeed = 2;
                        this.glowIntensity = 15;
                        break;
                    case 'fireflies':
                        this.particleSpeed = 0.8;
                        this.glowIntensity = 25;
                        break;
                    case 'rainbow':
                        this.particleSpeed = 1.5;
                        this.glowIntensity = 20;
                        break;
                }
                this.updateControlsUI();
                this.initParticles();
                this.activeEffect = `Preset: ${preset.charAt(0).toUpperCase() + preset.slice(1)}`;
                document.getElementById('currentEffect').textContent = this.activeEffect;
            }
            
            updateControlsUI() {
                document.getElementById('particleSpeed').value = this.particleSpeed;
                document.getElementById('glowIntensity').value = this.glowIntensity;
                document.getElementById('particleCount').value = this.particleCount;
                document.getElementById('connectionRadius').value = this.connectionRadius;
                
                document.getElementById('particleCountValue').textContent = this.particleCount;
                document.getElementById('connectionRadiusValue').textContent = this.connectionRadius;
                document.getElementById('particleSpeedValue').textContent = this.particleSpeed.toFixed(1);
                document.getElementById('glowIntensityValue').textContent = this.glowIntensity;
            }
            
            toggleEffect(buttonId, effectName) {
                const button = document.getElementById(buttonId);
                button.classList.toggle('active');
                const isActive = button.classList.contains('active');
                this.activeEffect = isActive ? effectName : "None";
                document.getElementById('currentEffect').textContent = this.activeEffect;
            }
            
            toggleGravityWell() {
                this.gravityWellActive = !this.gravityWellActive;
                this.toggleEffect('gravityBtn', 'Gravity Well');
            }
            
            toggleTimeDilation() {
                this.timeDilationActive = !this.timeDilationActive;
                this.toggleEffect('timeBtn', 'Time Dilation');
            }
            
            toggleVortex() {
                this.vortexActive = !this.vortexActive;
                this.vortexCenter = { x: this.width/2, y: this.height/2 };
                this.toggleEffect('vortexBtn', 'Quantum Vortex');
            }

            toggleColorWave() {
                this.colorWaveActive = !this.colorWaveActive;
                this.toggleEffect('colorBtn', 'Color Wave');
            }

            toggleRepulsion() {
                this.repulsionActive = !this.repulsionActive;
                this.toggleEffect('repulsionBtn', 'Pauli Repulsion');
            }

            togglePulseWave() {
                this.pulseWaveActive = !this.pulseWaveActive;
                this.pulseTime = 0;
                this.toggleEffect('pulseBtn', 'Pulse Wave');
            }

            toggleTornado() {
                this.tornadoActive = !this.tornadoActive;
                this.tornadoAngle = 0;
                this.toggleEffect('tornadoBtn', 'Quantum Tornado');
            }

            toggleBlackHole() {
                this.blackHoleActive = !this.blackHoleActive;
                this.blackHoleCenter = { x: this.width/2, y: this.height/2 };
                this.toggleEffect('blackholeBtn', 'Black Hole');
            }

            toggleTrails() {
                this.trailsActive = !this.trailsActive;
                this.toggleEffect('trailsBtn', 'State Trails');
                if (!this.trailsActive) {
                    for (let particle of this.particles) {
                        particle.trail = [];
                    }
                }
            }

            triggerExplosion() {
                this.explosionTime = performance.now();
                const centerX = this.width / 2;
                const centerY = this.height / 2;
                for (let particle of this.particles) {
                    const dx = particle.x - centerX;
                    const dy = particle.y - centerY;
                    const distance = Math.hypot(dx, dy);
                    const angle = Math.atan2(dy, dx);
                    const speed = Math.random() * 10 + 5;
                    particle.dx = Math.cos(angle) * speed;
                    particle.dy = Math.sin(angle) * speed;
                }
                
                this.activeEffect = "Quantum Collapse";
                document.getElementById('currentEffect').textContent = this.activeEffect;
                setTimeout(() => {
                    if (this.activeEffect === "Quantum Collapse") {
                        this.activeEffect = "None";
                        document.getElementById('currentEffect').textContent = this.activeEffect;
                    }
                }, 2000);
            }
            
            resize() {
                this.canvas.width = this.canvas.clientWidth;
                this.canvas.height = this.canvas.clientHeight;
                this.width = this.canvas.width;
                this.height = this.canvas.height;
                this.vortexCenter = { x: this.width/2, y: this.height/2 };
                this.blackHoleCenter = { x: this.width/2, y: this.height/2 };
            }
            
            initParticles() {
                this.particles = [];
                for (let i = 0; i < this.particleCount; i++) {
                    this.particles.push(new QuantumParticle(
                        Math.random() * this.width,
                        Math.random() * this.height,
                        this.colorSchemes[this.currentColorScheme](),
                        this.particleSpeed
                    ));
                }
                document.getElementById('particleCounter').textContent = this.particleCount;
            }
            
            drawConnections() {
                this.ctx.beginPath();
                let connections = 0;
                
                for (let i = 0; i < this.particles.length; i++) {
                    for (let j = i + 1; j < this.particles.length; j++) {
                        const p1 = this.particles[i];
                        const p2 = this.particles[j];
                        const distance = Math.hypot(p1.x - p2.x, p1.y - p2.y);
                        
                        if (distance < this.connectionRadius) {
                            connections++;
                            const opacity = 1 - (distance / this.connectionRadius);
                            this.ctx.strokeStyle = `rgba(100, 200, 255, ${opacity * 0.3})`;
                            this.ctx.moveTo(p1.x, p1.y);
                            this.ctx.lineTo(p2.x, p2.y);
                        }
                    }
                }
                
                this.ctx.stroke();
                this.entanglementCount = connections;
                document.getElementById('entanglementCounter').textContent = connections;
            }
            
            updateFPS() {
                const now = performance.now();
                const delta = now - this.lastTime;
                this.frameCount++;
                
                if (now - this.lastFpsUpdate > 1000) {
                    this.fps = Math.round(this.frameCount * 1000 / (now - this.lastFpsUpdate));
                    document.getElementById('fpsCounter').textContent = this.fps;
                    this.frameCount = 0;
                    this.lastFpsUpdate = now;
                    
                    // Check for low FPS condition
                    if (this.fps < 20 && this.fps > 0 && now - this.startTime > 5000) {
                        if (!this.lowFpsWarning) {
                            this.lowFpsWarning = true;
                            document.getElementById('fpsWarning').style.display = 'block';
                            
                            // Optimize instead of resetting
                            this.particleCount = Math.max(50, Math.floor(this.particleCount * 0.7));
                            this.initParticles();
                            document.getElementById('particleCount').value = this.particleCount;
                            document.getElementById('particleCountValue').textContent = this.particleCount;
                            
                            setTimeout(() => {
                                document.getElementById('fpsWarning').style.display = 'none';
                                this.lowFpsWarning = false;
                            }, 3000);
                        }
                    }
                }
                
                this.lastTime = now;
                return delta;
            }
            
            updateQuantumState() {
                const states = [
                    "|0⟩", "|1⟩", "|+⟩", "|-⟩", 
                    "α|0⟩ + β|1⟩", "|ψ⟩", "|φ⟩", 
                    "|00⟩ + |11⟩", "|01⟩ - |10⟩"
                ];
                
                if (!this.quantumAlgorithmActive) {
                    this.quantumState = states[Math.floor(Math.random() * states.length)];
                }
                
                document.getElementById('quantumState').textContent = this.quantumState;
                setTimeout(() => this.updateQuantumState(), 2000);
            }
            
            runGroverAlgorithm() {
                this.quantumAlgorithmActive = true;
                this.quantumState = "Running Grover's Search...";
                document.getElementById('groverBtn').classList.add('active');
                this.algorithmTime = performance.now();
                
                this.visualizeQuantumCircuit("Grover");
                
                // Create search target
                this.searchTarget = {
                    x: this.width/2 + (Math.random() - 0.5) * this.width * 0.7,
                    y: this.height/2 + (Math.random() - 0.5) * this.height * 0.7,
                    radius: 20
                };
                
                this.activeEffect = "Grover's Algorithm";
                document.getElementById('currentEffect').textContent = this.activeEffect;
            }
            
            runShorAlgorithm() {
                this.quantumAlgorithmActive = true;
                this.quantumState = "Running Shor's Factorization...";
                document.getElementById('shorBtn').classList.add('active');
                this.algorithmTime = performance.now();
                
                this.visualizeQuantumCircuit("Shor");
                
                // Algorithm effects - particles form factor patterns
                const factors = [2, 3, 5, 7, 11];
                this.factor = factors[Math.floor(Math.random() * factors.length)];
                
                this.activeEffect = "Shor's Algorithm";
                document.getElementById('currentEffect').textContent = this.activeEffect;
            }
            
            visualizeQuantumCircuit(algorithm) {
                const container = document.getElementById('circuitContainer');
                container.innerHTML = '';
                
                const qubitCount = 3;
                const lineHeight = container.clientHeight / qubitCount;
                
                for (let i = 0; i < qubitCount; i++) {
                    const line = document.createElement('div');
                    line.className = 'circuit-line';
                    line.style.top = `${(i + 0.5) * lineHeight}px`;
                    line.style.width = '100%';
                    container.appendChild(line);
                }
                
                if (algorithm === "Grover") {
                    this.addQuantumGate(container, 20, lineHeight * 0.5, 'H');
                    this.addQuantumGate(container, 40, lineHeight * 1.5, 'H');
                    this.addQuantumGate(container, 60, lineHeight * 2.5, 'H');
                    
                    this.addQuantumGate(container, 100, lineHeight * 1.5, 'X');
                    this.addQuantumGate(container, 120, lineHeight * 0.5, '●');
                    this.addQuantumGate(container, 120, lineHeight * 2.5, '○');
                    this.addQuantumGate(container, 140, lineHeight * 1.5, 'X');
                    
                    this.addQuantumGate(container, 180, lineHeight * 0.5, 'H');
                    this.addQuantumGate(container, 200, lineHeight * 1.5, 'H');
                    this.addQuantumGate(container, 220, lineHeight * 2.5, 'H');
                } else if (algorithm === "Shor") {
                    this.addQuantumGate(container, 20, lineHeight * 0.5, 'H');
                    this.addQuantumGate(container, 40, lineHeight * 1.5, 'H');
                    this.addQuantumGate(container, 60, lineHeight * 2.5, 'H');
                    
                    this.addQuantumGate(container, 100, lineHeight * 0.5, '●');
                    this.addQuantumGate(container, 100, lineHeight * 1.5, '⊕');
                    this.addQuantumGate(container, 100, lineHeight * 2.5, '⊕');
                    
                    this.addQuantumGate(container, 140, lineHeight * 1.5, 'U');
                    this.addQuantumGate(container, 140, lineHeight * 2.5, 'U²');
                    
                    this.addQuantumGate(container, 180, lineHeight * 1.5, 'QFT†');
                }
            }
            
            addQuantumGate(container, left, top, symbol) {
                const gate = document.createElement('div');
                gate.className = 'gate';
                gate.style.left = `${left}px`;
                gate.style.top = `${top}px`;
                gate.textContent = symbol;
                container.appendChild(gate);
            }
            
            quantumEntanglement() {
                this.entanglementCount = Math.min(20, Math.floor(this.particles.length / 2));
                
                for (let i = 0; i < this.entanglementCount; i++) {
                    const p1 = this.particles[i * 2];
                    const p2 = this.particles[i * 2 + 1];
                    
                    p1.entangledWith = p2;
                    p2.entangledWith = p1;
                    
                    const color = this.colorSchemes.rainbow();
                    p1.color = color;
                    p2.color = color;
                }
                
                document.getElementById('entanglementCounter').textContent = this.entanglementCount;
                this.activeEffect = "Quantum Entanglement";
                document.getElementById('currentEffect').textContent = this.activeEffect;
                setTimeout(() => {
                    if (this.activeEffect === "Quantum Entanglement") {
                        this.activeEffect = "None";
                        document.getElementById('currentEffect').textContent = this.activeEffect;
                    }
                }, 2000);
            }
            
            animate() {
                const delta = this.updateFPS();
                this.ctx.clearRect(0, 0, this.width, this.height);
                
                // Background with fade effect
                this.ctx.fillStyle = this.trailsActive ? 'rgba(0, 0, 0, 0.1)' : 'rgba(0, 0, 0, 0.2)';
                this.ctx.fillRect(0, 0, this.width, this.height);

                // Update effects
                if (this.pulseWaveActive) this.pulseTime += delta * 0.001;
                if (this.tornadoActive) this.tornadoAngle += delta * 0.001;
                if (this.colorWaveActive) this.colorWaveOffset += delta * 0.001;
                
                // Handle algorithm timeouts
                if (this.quantumAlgorithmActive && performance.now() - this.algorithmTime > 5000) {
                    this.quantumAlgorithmActive = false;
                    document.getElementById('groverBtn').classList.remove('active');
                    document.getElementById('shorBtn').classList.remove('active');
                    if (this.activeEffect.includes("Algorithm")) {
                        this.activeEffect = "None";
                        document.getElementById('currentEffect').textContent = this.activeEffect;
                    }
                    this.searchTarget = null;
                }
                
                // Draw connections
                this.drawConnections();
                
                // Update and draw particles
                const centerX = this.width / 2;
                const centerY = this.height / 2;
                
                for (let particle of this.particles) {
                    // Draw trails
                    if (this.trailsActive) {
                        this.ctx.beginPath();
                        this.ctx.strokeStyle = particle.color.replace('0.8', '0.2');
                        this.ctx.lineWidth = particle.radius * 0.5;
                        
                        if (!particle.trail) particle.trail = [];
                        particle.trail.push({ x: particle.x, y: particle.y });
                        if (particle.trail.length > 10) particle.trail.shift();
                        
                        if (particle.trail.length > 1) {
                            this.ctx.moveTo(particle.trail[0].x, particle.trail[0].y);
                            for (let i = 1; i < particle.trail.length; i++) {
                                this.ctx.lineTo(particle.trail[i].x, particle.trail[i].y);
                            }
                            this.ctx.stroke();
                        }
                    }

                    // Gravity Well
                    if (this.gravityWellActive) {
                        const dx = this.mousePos.x - particle.x;
                        const dy = this.mousePos.y - particle.y;
                        const distance = Math.hypot(dx, dy);
                        if (distance < 200) {
                            const force = (200 - distance) * 0.0005;
                            particle.dx += dx * force;
                            particle.dy += dy * force;
                        }
                    }
                    
                    // Vortex effect
                    if (this.vortexActive) {
                        const dx = particle.x - this.vortexCenter.x;
                        const dy = particle.y - this.vortexCenter.y;
                        const distance = Math.hypot(dx, dy);
                        
                        if (distance < 300) {
                            const angle = Math.atan2(dy, dx);
                            const rotationSpeed = (300 - distance) * 0.0001;
                            
                            // Rotate particle around vortex center
                            particle.dx += Math.cos(angle + Math.PI/2) * rotationSpeed * 10;
                            particle.dy += Math.sin(angle + Math.PI/2) * rotationSpeed * 10;
                            
                            // Pull particles towards the center
                            const pullStrength = 0.0002;
                            particle.dx -= dx * pullStrength;
                            particle.dy -= dy * pullStrength;
                        }
                    }
                    
                    // Black Hole effect
                    if (this.blackHoleActive) {
                        const dx = particle.x - this.blackHoleCenter.x;
                        const dy = particle.y - this.blackHoleCenter.y;
                        const distance = Math.hypot(dx, dy);
                        
                        if (distance < 400) {
                            const angle = Math.atan2(dy, dx);
                            const pullStrength = (400 - distance) * 0.0003;
                            
                            // Pull particles towards the center
                            particle.dx -= dx * pullStrength;
                            particle.dy -= dy * pullStrength;
                            
                            // Event horizon effect
                            if (distance < 50) {
                                particle.dx *= 0.9;
                                particle.dy *= 0.9;
                            }
                        }
                    }
                    
                    // Grover's algorithm effect
                    if (this.searchTarget) {
                        const dx = this.searchTarget.x - particle.x;
                        const dy = this.searchTarget.y - particle.y;
                        const distance = Math.hypot(dx, dy);
                        const angle = Math.atan2(dy, dx);

                        // Grover's amplification
                        const amplification = Math.min(2, 1 / (distance * 0.01));
                        particle.dx += Math.cos(angle) * amplification * 0.2;
                        particle.dy += Math.sin(angle) * amplification * 0.2;
                    }
                    
                    // Shor's algorithm effect
                    if (this.activeEffect === "Shor's Algorithm") {
                        const index = this.particles.indexOf(particle);
                        const angle = (index % this.factor) * (2 * Math.PI / this.factor);
                        const radius = Math.min(this.width, this.height) * 0.3;
                        
                        const targetX = centerX + Math.cos(angle) * radius;
                        const targetY = centerY + Math.sin(angle) * radius;
                        
                        particle.dx += (targetX - particle.x) * 0.01;
                        particle.dy += (targetY - particle.y) * 0.01;
                    }
                    
                    // Time Dilation
                    if (this.timeDilationActive) {
                        const distanceToCenter = Math.hypot(
                            particle.x - centerX,
                            particle.y - centerY
                        );
                        const timeScale = 1 - (Math.min(distanceToCenter, 300) / 300) * 0.8;
                        particle.update(this.width, this.height, delta * timeScale);
                    } else {
                        particle.update(this.width, this.height, delta);
                    }
                    
                    particle.draw(this.ctx, this.glowIntensity);
                }
                
                // Draw Grover's target
                if (this.searchTarget) {
                    this.ctx.beginPath();
                    this.ctx.arc(this.searchTarget.x, this.searchTarget.y, this.searchTarget.radius, 0, Math.PI * 2);
                    this.ctx.fillStyle = 'rgba(255, 50, 50, 0.3)';
                    this.ctx.fill();

                    // Pulsing effect
                    const pulse = Math.sin(Date.now() * 0.005) * 5 + 10;
                    this.ctx.beginPath();
                    this.ctx.arc(this.searchTarget.x, this.searchTarget.y, this.searchTarget.radius + pulse, 0, Math.PI * 2);
                    this.ctx.strokeStyle = 'rgba(255, 100, 100, 0.5)';
                    this.ctx.lineWidth = 2;
                    this.ctx.stroke();
                }
                
                // Draw vortex center if active
                if (this.vortexActive) {
                    this.ctx.beginPath();
                    this.ctx.arc(this.vortexCenter.x, this.vortexCenter.y, 10, 0, Math.PI * 2);
                    this.ctx.fillStyle = 'rgba(100, 200, 255, 0.5)';
                    this.ctx.fill();
                }
                
                // Draw black hole center if active
                if (this.blackHoleActive) {
                    this.ctx.beginPath();
                    this.ctx.arc(this.blackHoleCenter.x, this.blackHoleCenter.y, 20, 0, Math.PI * 2);
                    this.ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                    this.ctx.fill();
                    
                    // Event horizon
                    this.ctx.beginPath();
                    this.ctx.arc(this.blackHoleCenter.x, this.blackHoleCenter.y, 50, 0, Math.PI * 2);
                    this.ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                    this.ctx.lineWidth = 2;
                    this.ctx.stroke();
                }
                
                requestAnimationFrame(() => this.animate());
            }

            randomize() {
                this.particleCount = Math.floor(Math.random() * 450) + 50;
                this.connectionRadius = Math.floor(Math.random() * 250) + 50;
                this.particleSpeed = parseFloat((Math.random() * 2.9 + 0.1).toFixed(1));
                this.glowIntensity = Math.floor(Math.random() * 40);

                this.updateControlsUI();

                if (Math.random() < 0.25) {
                    const presets = ['cosmic', 'matrix', 'fireflies', 'rainbow'];
                    const randomPreset = presets[Math.floor(Math.random() * presets.length)];
                    this.setPreset(randomPreset);
                } else {
                    const hue = Math.random() * 360;
                    this.currentColorScheme = 'default';
                    this.colorSchemes.default = () => `hsla(${hue}, 80%, 60%, 0.8)`;
                }

                this.gravityWellActive = Math.random() < 0.3;
                this.timeDilationActive = Math.random() < 0.3;
                this.vortexActive = Math.random() < 0.3;
                this.colorWaveActive = Math.random() < 0.3;
                this.repulsionActive = Math.random() < 0.3;
                this.pulseWaveActive = Math.random() < 0.3;
                this.tornadoActive = Math.random() < 0.3;
                this.blackHoleActive = Math.random() < 0.3;
                this.trailsActive = Math.random() < 0.3;

                this.initParticles();
                this.updateParticleSpeed();
                
                const effects = [
                    'gravityBtn', 'timeBtn', 'vortexBtn', 'colorBtn',
                    'repulsionBtn', 'pulseBtn', 'tornadoBtn', 'blackholeBtn', 'trailsBtn'
                ];
                
                effects.forEach(effect => {
                    const button = document.getElementById(effect);
                    const effectName = effect.replace('Btn', '');
                    const active = this[`${effectName}Active`];
                    
                    if (active) {
                        button.classList.add('active');
                    } else {
                        button.classList.remove('active');
                    }
                });
                
                this.activeEffect = "Randomized System";
                document.getElementById('currentEffect').textContent = this.activeEffect;
                setTimeout(() => {
                    if (this.activeEffect === "Randomized System") {
                        this.activeEffect = "None";
                        document.getElementById('currentEffect').textContent = this.activeEffect;
                    }
                }, 2000);
            }
        }

        // Initialize the animation when the page loads
        window.addEventListener('load', () => {
            window.animation = new QuantumParticleAnimation();
        });
    </script>
</body>
</html>